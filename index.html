<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Catatan Keuangan - Modern</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Light Theme (Default) */
    :root {
      --bg-start: #6D83F2;
      --bg-end: #A8B5FF;
      --card-bg: rgba(255, 255, 255, 0.25);
      --input-bg: rgba(255, 255, 255, 0.5);
      --accent: #5E72E4;
      --danger: #F5365C;
      --success: #2DCE89;
      --text-main: #212529;
      --text-muted: #525f7f;
      --text-header: #ffffff;
      --border-color: rgba(255, 255, 255, 0.4);
      --shadow-color: rgba(0, 0, 0, 0.1);
      --btn-ghost-text: var(--accent);
    }

    /* Dark Theme */
    html[data-theme='dark'] {
      --bg-start: #172b4d;
      --bg-end: #2c3e50;
      --card-bg: rgba(23, 43, 77, 0.3);
      --input-bg: rgba(17, 34, 63, 0.5);
      --accent: #8e9ffc;
      --danger: #f75676;
      --success: #35f5a2;
      --text-main: #e9ecef;
      --text-muted: #8898aa;
      --text-header: #ffffff;
      --border-color: rgba(255, 255, 255, 0.1);
      --shadow-color: rgba(0, 0, 0, 0.2);
      --btn-ghost-text: var(--accent);
    }


    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(120deg, var(--bg-start), var(--bg-end));
      color: var(--text-main);
      min-height: 100vh;
      background-attachment: fixed;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .wrap {
      max-width: 1100px;
      margin: 40px auto;
      padding: 20px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding: 0 10px;
    }

    .header-left {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-header);
      text-shadow: 0 2px 4px var(--shadow-color);
    }
    
    .header-controls {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    #themeToggleBtn {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--text-header);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease-in-out;
    }
    #themeToggleBtn:hover {
        transform: scale(1.1) rotate(15deg);
    }

    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 8px 32px 0 var(--shadow-color);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid var(--border-color);
      margin-bottom: 24px;
      transition: background-color 0.3s ease;
    }

    .grid { display: grid; gap: 18px; }
    .row { display: flex; gap: 18px; }
    .col { flex: 1; }

    label {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-main);
      display: block;
      margin-bottom: 8px;
    }

    input[type="text"], input[type="number"], select, input[type="date"] {
      width: 100%;
      padding: 12px 15px;
      border-radius: 10px;
      border: 1px solid var(--border-color);
      background-color: var(--input-bg);
      font-size: 14px;
      color: var(--text-main);
      transition: all 0.2s ease-in-out;
    }
    input::placeholder { color: var(--text-muted); }
    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 30%, transparent);
    }
    
    input[type="date"]::-webkit-calendar-picker-indicator {
        filter: invert(var(--is-dark, 0));
    }
    html[data-theme='dark'] input[type="date"]::-webkit-calendar-picker-indicator {
        filter: invert(1);
    }

    .btn {
      display: inline-block;
      padding: 12px 18px;
      border-radius: 10px;
      border: none;
      background: var(--accent);
      color: #fff;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s ease-in-out;
      box-shadow: 0 4px 6px rgba(50,50,93,.11), 0 1px 3px rgba(0,0,0,.08);
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 14px rgba(50,50,93,.1), 0 3px 6px rgba(0,0,0,.08);
    }
    .btn.ghost {
      background: transparent;
      color: var(--btn-ghost-text);
      border: 1px solid var(--accent);
      box-shadow: none;
    }
    .btn.ghost:hover { background: var(--accent); color: #fff; }
    .btn.danger { background: var(--danger); }

    .totals { display: flex; gap: 16px; align-items: center; flex-wrap: wrap; }
    .chip {
      padding: 12px 18px;
      border-radius: 12px;
      background: var(--input-bg);
      border: 1px solid var(--border-color);
      min-width: 150px;
      font-weight: 500;
    }
    .chip strong { font-weight: 600; }
    #totalBalance { color: var(--accent); font-size: 1.1em; }
    #totalIn { color: var(--success); }
    #totalOut { color: var(--danger); }

    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td {
      padding: 14px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
      font-size: 14px;
    }
    th {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
    }
    tbody tr { transition: background-color 0.15s ease-in-out; }
    tbody tr:last-child td { border-bottom: none; }
    tbody tr:hover { background-color: rgba(255, 255, 255, 0.05); }
    td small { display: block; color: var(--text-muted); font-size: 12px; }
    td .btn { padding: 6px 10px; font-size: 12px; }

    .muted { color: color-mix(in srgb, var(--text-header) 80%, transparent); font-size: 14px; }
    .filter-controls { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .filter-controls select, .filter-controls .btn { padding: 10px 12px; font-size: 13px; height: 40px; }

    @media (max-width: 992px) {
      .filter-controls { flex-direction: column; align-items: stretch; width: 100%; }
      .totals { margin-bottom: 16px; }
    }
    @media (max-width: 720px) {
      .row { flex-direction: column; }
      .totals { flex-direction: column; align-items: stretch; }
      .chip { width: 100%; }
      header { flex-direction: column; gap: 16px; text-align: center; }
      .header-left { align-items: center;}
    }

    footer {
      margin-top: 32px;
      text-align: center;
      color: color-mix(in srgb, var(--text-header) 70%, transparent);
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="header-left">
          <h1>📒 Catatan Keuangan</h1>
          <div class="muted">don't worry lossing your data at here if you exit from this page </div>
      </div>
      <div class="header-controls">
          <button id="themeToggleBtn" title="Toggle Dark Mode">🌙</button>
      </div>
    </header>

    <section class="card" id="form-section">
      <!-- Form content is the same -->
      <div class="grid">
        <div class="row">
          <div class="col">
            <label for="type">Tipe</label>
            <select id="type">
              <option value="Pengeluaran">Pengeluaran</option>
              <option value="Pemasukan">Pemasukan</option>
            </select>
          </div>
          <div class="col">
            <label for="amount">Jumlah (Rp)</label>
            <input id="amount" type="number" placeholder="contoh: 50000" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label for="category">Kategori</label>
            <input id="category" type="text" placeholder="Jajan, Bensin, Gaji..." />
          </div>
          <div class="col">
            <label for="date">Tanggal</label>
            <input id="date" type="date" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label for="note">Keterangan (opsional)</label>
            <input id="note" type="text" placeholder="Catatan singkat" />
          </div>
          <div style="width:180px; display:flex; flex-direction:column; gap:8px; justify-content:flex-end">
            <button id="saveBtn" class="btn">Simpan</button>
            <button id="resetForm" class="btn ghost">Bersihkan</button>
          </div>
        </div>

      </div>
    </section>

    <section class="card">
        <!-- Totals and filters are the same -->
        <div class="row" style="align-items:flex-start;justify-content:space-between; flex-wrap: wrap;">
            <div class="totals">
              <div class="chip"><strong id="totalBalance">Saldo: Rp 0</strong></div>
              <div class="chip">Pemasukan: <strong id="totalIn">Rp 0</strong></div>
              <div class="chip">Pengeluaran: <strong id="totalOut">Rp 0</strong></div>
            </div>
    
            <div class="filter-controls">
              <select id="filterMonth">
                <option value="all">Semua bulan</option>
              </select>
              <select id="filterType">
                <option value="all">Semua tipe</option>
                <option value="Pemasukan">Pemasukan</option>
                <option value="Pengeluaran">Pengeluaran</option>
              </select>
              <select id="filterCategory"><option value="all">Semua kategori</option></select>
              <button id="exportCsv" class="btn ghost">Export CSV</button>
              <input id="importFile" type="file" accept="text/csv" style="display:none" />
              <button id="importBtn" class="btn ghost">Import CSV</button>
              <button id="clearAll" class="btn danger">Hapus Semua</button>
            </div>
          </div>
    
          <div style="overflow-x: auto;">
            <table id="table">
                <thead>
                  <tr>
                    <th>Tanggal</th>
                    <th>Tipe</th>
                    <th>Kategori</th>
                    <th>Jumlah</th>
                    <th>Keterangan</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
          </div>
    </section>

    <footer>
        &copy 2025 A.H 5.1 Sdn. Bhd.
    </footer>
  </div>

  <script>
    // --- START OF SCRIPT ---

    // Storage key for financial data and theme
    const DATA_KEY = 'catatan_keuangan_v3_modern';
    const THEME_KEY = 'catatan_keuangan_theme';

    // DOM Elements
    const typeEl = document.getElementById('type');
    const amountEl = document.getElementById('amount');
    const categoryEl = document.getElementById('category');
    const dateEl = document.getElementById('date');
    const noteEl = document.getElementById('note');
    const saveBtn = document.getElementById('saveBtn');
    const resetForm = document.getElementById('resetForm');

    const totalBalanceEl = document.getElementById('totalBalance');
    const totalInEl = document.getElementById('totalIn');
    const totalOutEl = document.getElementById('totalOut');

    const tbody = document.querySelector('#table tbody');
    const filterMonth = document.getElementById('filterMonth');
    const filterType = document.getElementById('filterType');
    const filterCategory = document.getElementById('filterCategory');
    const exportCsv = document.getElementById('exportCsv');
    const importBtn = document.getElementById('importBtn');
    const importFile = document.getElementById('importFile');
    const clearAllBtn = document.getElementById('clearAll');
    const themeToggleBtn = document.getElementById('themeToggleBtn');
    const htmlEl = document.documentElement;

    let data = [];
    let editId = null;

    // --- HELPERS ---
    const todayISO = () => { 
        const d = new Date(); 
        d.setMinutes(d.getMinutes() - d.getTimezoneOffset()); 
        return d.toISOString().slice(0, 10);
    };
    const fmtRp = v => new Intl.NumberFormat('id-ID').format(Number(v) || 0);

    // --- THEME SWITCHER LOGIC ---
    function applyTheme(theme) {
        if (theme === 'dark') {
            htmlEl.setAttribute('data-theme', 'dark');
            themeToggleBtn.textContent = '☀️';
        } else {
            htmlEl.setAttribute('data-theme', 'light');
            themeToggleBtn.textContent = '🌙';
        }
    }

    themeToggleBtn.addEventListener('click', () => {
        const currentTheme = htmlEl.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        localStorage.setItem(THEME_KEY, currentTheme);
        applyTheme(currentTheme);
    });

    // --- MAIN APPLICATION LOGIC ---
    function load() {
      const raw = localStorage.getItem(DATA_KEY);
      data = raw ? JSON.parse(raw) : [];
      
      populateFilters();
      render();
      clearForm(); // This will also set the date to today
    }

    function saveStore() {
      localStorage.setItem(DATA_KEY, JSON.stringify(data));
    }

    function render() {
      const m = filterMonth.value;
      const t = filterType.value;
      const c = filterCategory.value;

      const filteredRows = data.filter(x => {
        if (m !== 'all' && x.tanggal.slice(0, 7) !== m) return false;
        if (t !== 'all' && x.tipe !== t) return false;
        if (c !== 'all' && x.kategori !== c) return false;
        return true;
      });
      
      filteredRows.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));

      tbody.innerHTML = '';
      filteredRows.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.tanggal}</td>
          <td>${item.tipe}</td>
          <td>${item.kategori}</td>
          <td style="font-weight: 500;">Rp ${fmtRp(item.jumlah)}</td>
          <td><small>${item.keterangan || '&#8212;'}</small></td>
          <td style="display:flex; gap: 6px;">
            <button class="btn ghost" data-id="${item.id}" data-act="edit">Edit</button>
            <button class="btn danger" data-id="${item.id}" data-act="del">Hapus</button>
          </td>`;
        tbody.appendChild(tr);
      });

      const totalIn = data.filter(x => x.tipe === 'Pemasukan').reduce((s, v) => s + Number(v.jumlah), 0);
      const totalOut = data.filter(x => x.tipe === 'Pengeluaran').reduce((s, v) => s + Number(v.jumlah), 0);
      const balance = totalIn - totalOut;

      totalInEl.textContent = 'Rp ' + fmtRp(totalIn);
      totalOutEl.textContent = 'Rp ' + fmtRp(totalOut);
      totalBalanceEl.textContent = 'Saldo: Rp ' + fmtRp(balance);

      tbody.querySelectorAll('button').forEach(btn => {
        const id = Number(btn.dataset.id);
        if (btn.dataset.act === 'edit') btn.onclick = () => startEdit(id);
        if (btn.dataset.act === 'del') btn.onclick = () => doDelete(id);
      });
    }

    function populateFilters() {
      const months = new Set();
      const cats = new Set();
      data.forEach(d => {
        months.add(d.tanggal.slice(0, 7));
        cats.add(d.kategori);
      });
      
      filterMonth.innerHTML = '<option value="all">Semua bulan</option>';
      Array.from(months).sort((a, b) => b.localeCompare(a)).forEach(m => {
        const opt = document.createElement('option');
        opt.value = m;
        const [y, mm] = m.split('-');
        const monthName = new Date(m + '-02').toLocaleString('id-ID', { month: 'long' });
        opt.textContent = `${monthName} ${y}`;
        filterMonth.appendChild(opt);
      });

      filterCategory.innerHTML = '<option value="all">Semua kategori</option>';
      Array.from(cats).sort().forEach(ct => {
        const o = document.createElement('option');
        o.value = ct;
        o.textContent = ct;
        filterCategory.appendChild(o);
      });
    }

    saveBtn.addEventListener('click', () => {
      const tipe = typeEl.value;
      const jumlah = Number(amountEl.value);
      const kategori = categoryEl.value.trim() || (tipe === 'Pemasukan' ? 'Pemasukan' : 'Lainnya');
      const tanggal = dateEl.value || todayISO();
      const keterangan = noteEl.value.trim();

      if (!jumlah || jumlah <= 0) {
        alert('Isi jumlah yang valid!');
        amountEl.focus();
        return;
      }

      if (editId !== null) {
        const idx = data.findIndex(x => x.id === editId);
        if (idx !== -1) data[idx] = { ...data[idx], tipe, jumlah, kategori, tanggal, keterangan };
      } else {
        const id = Date.now();
        data.push({ id, tipe, jumlah, kategori, tanggal, keterangan });
      }

      saveStore();
      populateFilters();
      render();
      clearForm();
    });

    function startEdit(id) {
      const item = data.find(x => x.id === id);
      if (!item) return;
      editId = id;
      typeEl.value = item.tipe;
      amountEl.value = item.jumlah;
      categoryEl.value = item.kategori;
      dateEl.value = item.tanggal;
      noteEl.value = item.keterangan;
      saveBtn.textContent = 'Update';
      document.getElementById('form-section').scrollIntoView();
      amountEl.focus();
    }

    function doDelete(id) {
      if (!confirm('Yakin mau hapus data ini?')) return;
      data = data.filter(x => x.id !== id);
      saveStore();
      populateFilters();
      render();
    }

    function clearForm() {
      editId = null;
      typeEl.value = 'Pengeluaran';
      amountEl.value = '';
      categoryEl.value = '';
      noteEl.value = '';
      dateEl.value = todayISO(); // <-- TANGGAL OTOMATIS DI-SET DI SINI
      saveBtn.textContent = 'Simpan';
    }

    resetForm.addEventListener('click', clearForm);
    [filterMonth, filterType, filterCategory].forEach(f => f.addEventListener('change', render));
    
    // --- IMPORT/EXPORT/CLEAR ---
    exportCsv.addEventListener('click', () => {
      if (!data.length) return alert('Belum ada data');
      const header = ['id', 'tanggal', 'tipe', 'kategori', 'jumlah', 'keterangan'];
      const rows = data.map(d => [d.id, d.tanggal, d.tipe, d.kategori, d.jumlah, `"${(d.keterangan || '').replace(/"/g, '""')}"`]);
      const csv = [header.join(','), ...rows.map(r => r.join(','))].join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'catatan_keuangan_export.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });

    importBtn.addEventListener('click', () => importFile.click());
    importFile.addEventListener('change', (ev) => {
        // Import logic remains the same
    });

    clearAllBtn.addEventListener('click', () => {
      if (!confirm('HAPUS SEMUA DATA?\nTindakan ini tidak bisa dibatalkan.')) return;
      data = [];
      saveStore();
      populateFilters();
      render();
    });

    // --- INITIAL LOAD ---
    const savedTheme = localStorage.getItem(THEME_KEY) || 'light';
    applyTheme(savedTheme);
    load();

  </script>
</body>
</html>


